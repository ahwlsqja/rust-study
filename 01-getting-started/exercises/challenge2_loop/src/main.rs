// ============================================================
// 도전 과제 2: 반복 인사 프로그램
// ============================================================
// "quit"을 입력할 때까지 계속 이름을 입력받아 인사한다.
// loop, break, if 등 제어 흐름 구문을 학습한다.
// ============================================================

// ------------------------------------------------------------
// use 키워드로 표준 입출력 모듈 가져오기
// ------------------------------------------------------------
use std::io;

fn main() {
    // --------------------------------------------------------
    // 프로그램 시작 메시지
    // --------------------------------------------------------
    println!("====================================");
    println!("    반복 인사 프로그램");
    println!("    종료하려면 'quit'을 입력하세요");
    println!("====================================");
    println!();

    // --------------------------------------------------------
    // loop: 무한 반복문
    // --------------------------------------------------------
    // Rust의 loop는 명시적으로 break를 만날 때까지 무한히 반복한다.
    // 다른 언어의 while(true)와 비슷하지만, Rust에서는 loop를 권장한다.
    // 왜? loop는 "의도적인 무한 반복"임을 명확히 보여주기 때문이다.
    //
    // 반복문 종류 (02-basic-syntax에서 자세히):
    //   - loop: 무한 반복 (break로 탈출)
    //   - while: 조건이 참인 동안 반복
    //   - for: 컬렉션/범위를 순회
    loop {
        // ----------------------------------------------------
        // 매 반복마다 새로운 String 생성
        // ----------------------------------------------------
        // 왜 loop 안에서 선언하는가?
        //   read_line()은 기존 문자열에 "추가(append)"한다.
        //   만약 loop 밖에서 선언하면, 입력이 계속 누적된다.
        //   예: 첫 입력 "홍길동", 두 번째 입력 "김철수"
        //       -> name = "홍길동\n김철수\n" (원치 않는 결과!)
        //   매번 새로 생성하면 이 문제를 방지할 수 있다.
        //
        // ┌─────────────────────────────────────────────────────┐
        // │  메모리 구조: String                                │
        // ├─────────────────────────────────────────────────────┤
        // │                                                     │
        // │   스택 (Stack)              힙 (Heap)               │
        // │   ┌──────────────┐         ┌──────────────────┐    │
        // │   │ input 변수   │         │ 실제 문자열 데이터 │    │
        // │   ├──────────────┤    ┌───►│ "홍길동"          │    │
        // │   │ ptr ─────────┼────┘    └──────────────────┘    │
        // │   │ len: 9       │  (UTF-8에서 한글 1자 = 3바이트)  │
        // │   │ capacity: 16 │                                 │
        // │   └──────────────┘                                 │
        // │                                                     │
        // │   스택: 고정 크기, 빠름, 자동 정리                   │
        // │   힙:   가변 크기, 느림, 수동 관리 필요              │
        // │        (Rust는 소유권으로 자동 관리!)               │
        // └─────────────────────────────────────────────────────┘
        //
        // String의 구조:
        //   - ptr: 힙에 있는 실제 데이터를 가리키는 포인터
        //   - len: 현재 문자열의 길이 (바이트 단위)
        //   - capacity: 재할당 없이 저장 가능한 최대 크기
        let mut input = String::new();

        println!("이름을 입력하세요:");

        // ----------------------------------------------------
        // 사용자 입력 받기
        // ----------------------------------------------------
        io::stdin()
            .read_line(&mut input)
            .expect("입력 실패");

        // ----------------------------------------------------
        // trim(): 공백과 줄바꿈 제거
        // ----------------------------------------------------
        // ┌─────────────────────────────────────────────────────┐
        // │  trim() 동작 과정                                   │
        // ├─────────────────────────────────────────────────────┤
        // │                                                     │
        // │  입력 전:  "  홍길동  \n"                           │
        // │            ^^       ^^^                             │
        // │            │         │                              │
        // │            │         └─ 줄바꿈 + 공백               │
        // │            └─ 앞쪽 공백                             │
        // │                                                     │
        // │  trim() 후: "홍길동"                                │
        // │                                                     │
        // │  주의: trim()은 원본을 수정하지 않고                │
        // │        새로운 &str(문자열 슬라이스)을 반환한다      │
        // └─────────────────────────────────────────────────────┘
        let input = input.trim();

        // ----------------------------------------------------
        // if 조건문: 종료 조건 검사
        // ----------------------------------------------------
        // Rust의 if는 표현식(expression)이다.
        // 조건에 괄호()가 필요 없다 (있어도 되지만 권장하지 않음).
        //
        // == : 값이 같은지 비교 (다른 언어와 동일)
        // 문자열 비교도 ==로 가능하다 (내용 비교).
        if input == "quit" {
            // ------------------------------------------------
            // break: 반복문 탈출
            // ------------------------------------------------
            // break를 만나면 가장 가까운 loop/while/for를 빠져나간다.
            // 중첩 반복문에서 특정 반복문을 빠져나가려면 레이블을 사용한다.
            // 예: 'outer: loop { ... break 'outer; }
            println!();
            println!("프로그램을 종료합니다. 안녕히 가세요!");
            break;
        }

        // ----------------------------------------------------
        // 빈 입력 처리
        // ----------------------------------------------------
        // .is_empty(): 문자열이 비어있는지 확인 (true/false 반환)
        // continue: 현재 반복을 건너뛰고 다음 반복으로
        //
        // ┌─────────────────────────────────────────────────────┐
        // │  continue vs break                                  │
        // ├─────────────────────────────────────────────────────┤
        // │                                                     │
        // │  loop {                                             │
        // │      ...                                            │
        // │      if 조건A {                                     │
        // │          continue;  ─────► loop 처음으로 돌아감     │
        // │      }                                              │
        // │      ...                                            │
        // │      if 조건B {                                     │
        // │          break;     ─────► loop 완전히 탈출         │
        // │      }                                              │
        // │      ...                                            │
        // │  }                                                  │
        // │                                                     │
        // └─────────────────────────────────────────────────────┘
        if input.is_empty() {
            println!("이름을 입력해주세요!");
            println!();
            continue;  // 다음 반복으로 건너뛰기
        }

        // ----------------------------------------------------
        // 인사 메시지 출력
        // ----------------------------------------------------
        // 여기까지 왔다면:
        //   1. "quit"이 아니고
        //   2. 빈 문자열도 아님
        // 따라서 정상적인 이름이 입력된 것이다.
        println!("┌────────────────────────────────┐");
        println!("│ 안녕하세요, {:^16}님! │", input);
        println!("└────────────────────────────────┘");
        //       {:^16} 설명:
        //         { } : 플레이스홀더
        //         :   : 포맷 지정자 시작
        //         ^   : 가운데 정렬 (< 왼쪽, > 오른쪽)
        //         16  : 총 16칸 너비 확보
        //       예: "홍길동" -> "      홍길동      " (앞뒤 공백으로 채움)
        println!();

    }  // loop 끝

    // --------------------------------------------------------
    // loop를 빠져나오면 여기가 실행된다
    // --------------------------------------------------------
    // break 이후 이 지점에서 프로그램이 계속된다.
    // main() 함수가 끝나면 프로그램이 종료된다.
}
