# 제어 흐름

## 개요

제어 흐름(control flow)은 프로그램의 실행 순서를 결정한다. Rust는 `if` 조건문과 `loop`, `while`, `for` 반복문을 제공한다. 특히 Rust의 `if`와 `loop`는 표현식이므로 값을 반환할 수 있다는 특징이 있다.

---

## 이론

### 핵심 개념

#### 1. if 표현식

```
┌─────────────────────────────────────────────────────────────┐
│  if 표현식 구조                                             │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│   if 조건 {              <- 괄호() 필요 없음!              │
│       // 조건이 true일 때                                  │
│   } else if 다른조건 {   <- 선택적                         │
│       // 다른조건이 true일 때                              │
│   } else {               <- 선택적                         │
│       // 모든 조건이 false일 때                            │
│   }                                                         │
│                                                             │
│   중요: 조건은 반드시 bool 타입이어야 함!                  │
│   if 1 { ... }  <- 에러! (다른 언어와 다름)                │
│   if 1 != 0 { ... }  <- OK                                 │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

**if는 표현식이다**:

```
┌─────────────────────────────────────────────────────────────┐
│  if를 값으로 사용                                           │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│   // if 표현식의 결과를 변수에 할당                         │
│   let number = if condition { 5 } else { 6 };              │
│                                                             │
│   실행 흐름:                                                │
│   ┌──────────────┐                                         │
│   │ condition    │                                         │
│   └──────┬───────┘                                         │
│          │                                                  │
│     ┌────┴────┐                                            │
│     ▼         ▼                                            │
│   true      false                                          │
│     │         │                                            │
│     ▼         ▼                                            │
│   { 5 }     { 6 }                                          │
│     │         │                                            │
│     └────┬────┘                                            │
│          ▼                                                  │
│       number                                                │
│                                                             │
│   주의: 모든 분기의 반환 타입이 같아야 함!                 │
│   let x = if true { 5 } else { "six" };  <- 에러!         │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

#### 2. loop (무한 반복)

```
┌─────────────────────────────────────────────────────────────┐
│  loop 구조                                                  │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│   loop {                                                    │
│       // 무한 반복                                         │
│       if 종료조건 {                                        │
│           break;        <- 반복 종료                       │
│       }                                                     │
│       if 건너뛰기조건 {                                    │
│           continue;     <- 다음 반복으로                   │
│       }                                                     │
│   }                                                         │
│                                                             │
│   loop도 표현식! break로 값 반환 가능:                     │
│   let result = loop {                                      │
│       counter += 1;                                        │
│       if counter == 10 {                                   │
│           break counter * 2;  <- 20 반환                   │
│       }                                                     │
│   };                                                        │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

**루프 레이블**:

```
┌─────────────────────────────────────────────────────────────┐
│  중첩 루프와 레이블                                         │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│   'outer: loop {           <- 'outer 레이블               │
│       println!("외부 루프");                                │
│       'inner: loop {       <- 'inner 레이블               │
│           println!("내부 루프");                            │
│           break;           <- 내부 루프만 종료            │
│           break 'outer;    <- 외부 루프 종료              │
│       }                                                     │
│   }                                                         │
│                                                             │
│   레이블 문법: '이름 (작은따옴표 + 이름)                   │
│                                                             │
│   ┌─────────────────────────────────────┐                  │
│   │ 'outer: loop {                      │                  │
│   │   ┌───────────────────────────────┐ │                  │
│   │   │ 'inner: loop {                │ │                  │
│   │   │   break;      -> inner 종료   │ │                  │
│   │   │   break 'outer; -> outer 종료 │─┼──► 바깥으로     │
│   │   │ }                             │ │                  │
│   │   └───────────────────────────────┘ │                  │
│   │ }                                   │                  │
│   └─────────────────────────────────────┘                  │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

#### 3. while (조건부 반복)

```
┌─────────────────────────────────────────────────────────────┐
│  while 구조                                                 │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│   while 조건 {                                             │
│       // 조건이 true인 동안 반복                           │
│   }                                                         │
│                                                             │
│   실행 흐름:                                                │
│   ┌──────────┐                                             │
│   │ 조건 검사 │ <─────────────────────┐                    │
│   └────┬─────┘                        │                    │
│        │                              │                    │
│   ┌────┴────┐                         │                    │
│   ▼         ▼                         │                    │
│ true      false                       │                    │
│   │         │                         │                    │
│   ▼         ▼                         │                    │
│ { 본문 }   종료                       │                    │
│   │                                   │                    │
│   └───────────────────────────────────┘                    │
│                                                             │
│   예시:                                                     │
│   let mut count = 3;                                       │
│   while count > 0 {                                        │
│       println!("{}!", count);                              │
│       count -= 1;                                          │
│   }                                                         │
│   println!("발사!");                                        │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

#### 4. for (컬렉션 순회)

```
┌─────────────────────────────────────────────────────────────┐
│  for 구조                                                   │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│   for 요소 in 컬렉션 {                                     │
│       // 각 요소에 대해 실행                               │
│   }                                                         │
│                                                             │
│   배열 순회:                                                │
│   let arr = [10, 20, 30];                                  │
│   for num in arr {                                         │
│       println!("{}", num);                                 │
│   }                                                         │
│                                                             │
│   범위(Range) 순회:                                         │
│   for i in 0..5 {      <- 0, 1, 2, 3, 4 (5 미포함)        │
│       println!("{}", i);                                   │
│   }                                                         │
│                                                             │
│   for i in 0..=5 {     <- 0, 1, 2, 3, 4, 5 (5 포함)       │
│       println!("{}", i);                                   │
│   }                                                         │
│                                                             │
│   역순 순회:                                                │
│   for i in (1..4).rev() {   <- 3, 2, 1                    │
│       println!("{}", i);                                   │
│   }                                                         │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

**범위(Range) 타입**:

```
┌─────────────────────────────────────────────────────────────┐
│  Range 종류                                                 │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│   표기법          타입              범위                    │
│   ─────────────────────────────────────────────            │
│   a..b            Range             a 이상 b 미만          │
│   a..=b           RangeInclusive    a 이상 b 이하          │
│   a..             RangeFrom         a 이상                 │
│   ..b             RangeTo           b 미만                 │
│   ..=b            RangeToInclusive  b 이하                 │
│   ..              RangeFull         전체                   │
│                                                             │
│   시각화 (0..5 vs 0..=5):                                  │
│   0..5:   [0]─[1]─[2]─[3]─[4]─ ✕                          │
│                               5 미포함                     │
│   0..=5:  [0]─[1]─[2]─[3]─[4]─[5]                          │
│                               5 포함                       │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

#### 5. loop vs while vs for 비교

```
┌─────────────────────────────────────────────────────────────┐
│  반복문 선택 가이드                                         │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│   loop                                                      │
│   ─────                                                     │
│   - 무한 반복이 필요할 때                                  │
│   - 종료 조건이 복잡할 때                                  │
│   - 값을 반환해야 할 때 (break value)                      │
│   - 최소 1회 실행 보장                                     │
│                                                             │
│   while                                                     │
│   ─────                                                     │
│   - 조건이 false가 될 때까지 반복                          │
│   - 반복 횟수를 모를 때                                    │
│   - 0회 실행 가능 (조건이 처음부터 false면)                │
│                                                             │
│   for                                                       │
│   ────                                                      │
│   - 컬렉션 순회 (가장 많이 사용)                           │
│   - 정해진 횟수만큼 반복                                   │
│   - 범위 순회                                              │
│   - 안전함 (인덱스 범위 초과 방지)                         │
│                                                             │
│   권장: 가능하면 for를 사용하라 (안전하고 명확함)          │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

### 주의사항

1. **조건은 반드시 bool 타입**
```rust
if 1 { ... }  // 에러! Rust는 정수를 bool로 자동 변환 안 함
if 1 != 0 { ... }  // OK
```

2. **if 표현식의 타입 일치**
```rust
let x = if true { 5 } else { "문자열" };  // 에러! 타입 불일치
```

3. **무한 루프 주의**
```rust
loop {
    // break가 없으면 영원히 실행
}
```

4. **for에서 소유권 주의**
```rust
let v = vec![1, 2, 3];
for i in v {
    println!("{}", i);
}
// 여기서 v는 이동(move)되어 더 이상 사용 불가
// 참조로 순회하려면: for i in &v { ... }
```

---

## 실습

### 실습 1: if 표현식

목표: if를 조건문과 표현식으로 사용한다

코드:
```rust
fn main() {
    let number = 7;

    // 기본 if
    if number > 0 {
        println!("{}는 양수입니다", number);
    }

    // if-else
    if number % 2 == 0 {
        println!("{}는 짝수입니다", number);
    } else {
        println!("{}는 홀수입니다", number);
    }

    // if-else if-else
    let score = 85;
    if score >= 90 {
        println!("등급: A");
    } else if score >= 80 {
        println!("등급: B");
    } else if score >= 70 {
        println!("등급: C");
    } else {
        println!("등급: F");
    }

    // if 표현식으로 값 할당
    let condition = true;
    let value = if condition { "참" } else { "거짓" };
    println!("조건의 값: {}", value);

    // 복잡한 if 표현식
    let age = 25;
    let category = if age < 13 {
        "어린이"
    } else if age < 20 {
        "청소년"
    } else if age < 65 {
        "성인"
    } else {
        "노인"
    };
    println!("나이 {}세는 {} 입니다", age, category);
}
```

실행 결과:
```
7는 양수입니다
7는 홀수입니다
등급: B
조건의 값: 참
나이 25세는 성인 입니다
```

### 실습 2: loop 사용

목표: loop로 무한 반복과 값 반환을 구현한다

코드:
```rust
fn main() {
    // 기본 loop (break로 탈출)
    let mut count = 0;
    loop {
        count += 1;
        println!("카운트: {}", count);
        if count >= 3 {
            break;
        }
    }
    println!();

    // loop에서 값 반환
    let mut counter = 0;
    let result = loop {
        counter += 1;
        if counter == 10 {
            break counter * 2;  // 20 반환
        }
    };
    println!("loop 결과: {}", result);
    println!();

    // continue 사용
    let mut num = 0;
    loop {
        num += 1;
        if num > 10 {
            break;
        }
        if num % 2 == 0 {
            continue;  // 짝수면 건너뛰기
        }
        println!("홀수: {}", num);
    }
    println!();

    // 중첩 루프와 레이블
    let mut found = false;
    'outer: for i in 1..=3 {
        for j in 1..=3 {
            println!("({}, {})", i, j);
            if i == 2 && j == 2 {
                found = true;
                break 'outer;  // 외부 루프까지 종료
            }
        }
    }
    println!("(2, 2) 발견: {}", found);
}
```

실행 결과:
```
카운트: 1
카운트: 2
카운트: 3

loop 결과: 20

홀수: 1
홀수: 3
홀수: 5
홀수: 7
홀수: 9

(1, 1)
(1, 2)
(1, 3)
(2, 1)
(2, 2)
(2, 2) 발견: true
```

### 실습 3: while 사용

목표: while로 조건부 반복을 구현한다

코드:
```rust
fn main() {
    // 카운트다운
    let mut countdown = 5;
    while countdown > 0 {
        println!("{}...", countdown);
        countdown -= 1;
    }
    println!("발사!\n");

    // 배열 순회 (권장하지 않음 - for 사용 권장)
    let arr = [10, 20, 30, 40, 50];
    let mut index = 0;
    while index < arr.len() {
        println!("arr[{}] = {}", index, arr[index]);
        index += 1;
    }
    println!();

    // 합계 계산
    let mut sum = 0;
    let mut n = 1;
    while n <= 100 {
        sum += n;
        n += 1;
    }
    println!("1부터 100까지의 합: {}\n", sum);

    // 피보나치 (처음 10개)
    let mut a = 0;
    let mut b = 1;
    let mut count = 0;
    print!("피보나치: ");
    while count < 10 {
        print!("{} ", a);
        let temp = a + b;
        a = b;
        b = temp;
        count += 1;
    }
    println!();
}
```

실행 결과:
```
5...
4...
3...
2...
1...
발사!

arr[0] = 10
arr[1] = 20
arr[2] = 30
arr[3] = 40
arr[4] = 50

1부터 100까지의 합: 5050

피보나치: 0 1 1 2 3 5 8 13 21 34
```

### 실습 4: for 사용

목표: for로 컬렉션과 범위를 순회한다

코드:
```rust
fn main() {
    // 배열 순회 (권장 방법)
    let fruits = ["사과", "바나나", "오렌지", "포도"];
    for fruit in fruits {
        println!("과일: {}", fruit);
    }
    println!();

    // 범위 순회
    print!("1부터 5: ");
    for i in 1..=5 {
        print!("{} ", i);
    }
    println!("\n");

    // 역순 순회
    println!("카운트다운:");
    for i in (1..=5).rev() {
        println!("{}!", i);
    }
    println!("발사!\n");

    // 인덱스와 함께 순회
    let colors = ["빨강", "초록", "파랑"];
    for (index, color) in colors.iter().enumerate() {
        println!("{}: {}", index, color);
    }
    println!();

    // 구구단
    let dan = 7;
    println!("{}단:", dan);
    for i in 1..=9 {
        println!("{} x {} = {}", dan, i, dan * i);
    }
    println!();

    // 중첩 for (구구단 전체)
    println!("구구단 표:");
    for i in 2..=9 {
        for j in 1..=9 {
            print!("{:2}x{}={:2} ", i, j, i * j);
        }
        println!();
    }
}
```

실행 결과:
```
과일: 사과
과일: 바나나
과일: 오렌지
과일: 포도

1부터 5: 1 2 3 4 5

카운트다운:
5!
4!
3!
2!
1!
발사!

0: 빨강
1: 초록
2: 파랑

7단:
7 x 1 = 7
7 x 2 = 14
7 x 3 = 21
7 x 4 = 28
7 x 5 = 35
7 x 6 = 42
7 x 7 = 49
7 x 8 = 56
7 x 9 = 63

구구단 표:
 2x1= 2  2x2= 4  2x3= 6  2x4= 8  2x5=10  2x6=12  2x7=14  2x8=16  2x9=18
 3x1= 3  3x2= 6  3x3= 9  3x4=12  3x5=15  3x6=18  3x7=21  3x8=24  3x9=27
 4x1= 4  4x2= 8  4x3=12  4x4=16  4x5=20  4x6=24  4x7=28  4x8=32  4x9=36
 5x1= 5  5x2=10  5x3=15  5x4=20  5x5=25  5x6=30  5x7=35  5x8=40  5x9=45
 6x1= 6  6x2=12  6x3=18  6x4=24  6x5=30  6x6=36  6x7=42  6x8=48  6x9=54
 7x1= 7  7x2=14  7x3=21  7x4=28  7x5=35  7x6=42  7x7=49  7x8=56  7x9=63
 8x1= 8  8x2=16  8x3=24  8x4=32  8x5=40  8x6=48  8x7=56  8x8=64  8x9=72
 9x1= 9  9x2=18  9x3=27  9x4=36  9x5=45  9x6=54  9x7=63  9x8=72  9x9=81
```

---

## 정리

### 오늘 배운 것
- `if`는 표현식으로, 값을 반환할 수 있다 (타입 일치 필수)
- Rust의 조건은 반드시 bool 타입이어야 한다 (암묵적 변환 없음)
- `loop`는 무한 반복으로, `break`로 탈출하며 값 반환 가능
- `while`은 조건이 true인 동안 반복한다
- `for`는 컬렉션/범위 순회에 가장 적합하고 안전하다
- 범위 `..`는 끝값 미포함, `..=`는 끝값 포함
- 루프 레이블(`'label:`)로 중첩 루프에서 특정 루프를 제어한다

### 질문/의문점
- match 표현식은 무엇인가? (더 강력한 조건 분기)
- for에서 iter(), into_iter(), iter_mut()의 차이는?
- 이터레이터 어댑터(map, filter 등)는 어떻게 사용하는가?

### 추가 학습 필요
- match 표현식 (05-enums-pattern-matching에서 학습)
- 이터레이터 (11-closures-iterators에서 학습)
- while let, if let (05-enums-pattern-matching에서 학습)

---

## 참고 자료
- The Rust Programming Language - Control Flow: https://doc.rust-lang.org/book/ch03-05-control-flow.html
- Rust by Example - Flow of Control: https://doc.rust-lang.org/rust-by-example/flow_control.html
